# 番茄小说自动发布系统 - 使用指南

## 核心功能

### 1. 书本选择功能（新增）

支持多本书籍管理，可以指定发布到哪本书。

**功能说明：**
- 查看您在番茄小说平台的所有书籍
- 在发布前选择目标书本
- 如果只有一本书，会自动选择

**使用方法：**
```bash
python main.py
→ 选择 4. 查看书本列表
→ 程序会显示您的所有书籍
```

### 2. 批量定时发布（推荐）

这是最重要的功能！可以在番茄小说平台一次性设置所有章节的发布时间。

**实际效果：**

假设您有 100 章小说，想每天发布 2 章（早上 8 点和晚上 8 点）：

1. 运行程序，选择"批量定时发布"
2. 输入小说文件路径
3. **从列表中选择要发布的书本**
4. 设置每天发布 2 章，时间分别为 08:00 和 20:00
5. 确认开始

程序会自动为每一章设置发布时间：
- 第 1 章 → 明天 08:00
- 第 2 章 → 明天 20:00
- 第 3 章 → 后天 08:00
- 第 4 章 → 后天 20:00
- ...
- 第 99 章 → 第 50 天 08:00
- 第 100 章 → 第 50 天 20:00

**重要说明：**
- 所有时间设置在番茄平台完成
- 设置完成后，番茄平台会自动按时发布
- 您的电脑不需要保持开机
- 不需要每天操作，一次设置，自动完成

## 使用流程

### 第一次使用（6 步骤）

#### 1. 安装依赖
```bash
pip install -r requirements.txt
```

#### 2. 启动程序
```bash
python main.py
```

#### 3. 登录番茄小说（首次必须）
- 选择 `3. 测试登录`
- 浏览器会自动打开
- 扫码登录番茄小说
- 登录成功后按回车继续

#### 4. 查看书本列表（可选）
- 选择 `4. 查看书本列表`
- 程序会显示您的所有书籍
- 确认要发布到哪本书

#### 5. 测试小说解析
- 选择 `2. 测试小说解析`
- 输入小说文件路径（如：`我的小说.txt`）
- 查看是否能正确识别章节

#### 6. 批量定时发布
- 选择 `6. 批量定时发布`
- 输入小说文件路径
- **从列表中选择目标书本**
- 确认或修改配置
- 查看发布计划预览
- 确认开始

程序会自动为每一章设置定时发布，完成后可以关闭电脑。

## 常见使用场景

### 场景 1：新书发布，每天 2 章

```bash
python main.py
→ 选择 6
→ 输入小说路径
→ 选择书本（从列表中选择）
→ 使用默认配置（每天 2 章，08:00 和 20:00）
→ 确认开始
```

结果：程序自动为所有章节设置定时发布，番茄平台每天自动发布 2 章。

### 场景 2：多本书籍，发布到指定书本

```bash
python main.py
→ 选择 4（先查看书本列表）
→ 记住要发布的书本编号
→ 选择 6
→ 输入小说路径
→ 输入书本编号
→ 确认开始
```

### 场景 3：存量稿件，每天 3 章

修改配置文件 `config.json`：
```json
{
  "chapters_per_day": 3,
  "publish_times": ["08:00", "14:00", "20:00"]
}
```

然后运行程序选择 `6. 批量定时发布`。

### 场景 4：立即发布多章

如果您需要立即发布多章（不使用定时）：

```bash
python main.py
→ 选择 5
→ 输入小说路径
→ 选择目标书本
→ 输入要发布的章节数（如 10）
→ 确认开始
```

## 书本选择详解

### 自动获取书本列表

程序会尝试从番茄小说平台自动获取您的书本列表。

**如果成功：**
- 显示所有书籍
- 输入编号选择
- 程序自动点击选择

**如果失败：**
- 显示手动选择提示
- 浏览器打开发布页面
- 您手动在页面中选择书本
- 选择完成后输入 'ok' 继续

### 书本选择时机

1. **查看书本列表** - 功能 4
   - 随时可以查看
   - 不影响发布流程

2. **发布前选择** - 功能 5 和 6
   - 必须选择书本
   - 支持自动或手动选择

## 小说文件准备

### 推荐格式

```
第一章 开始

正文内容...

第二章 继续

正文内容...
```

### 文件要求

- 文件格式：.txt
- 文件编码：UTF-8 或 GBK
- 章节标题：使用可识别格式（如"第一章 标题"）

### 如果章节无法识别

1. 检查章节标题格式
2. 使用测试解析功能验证
3. 必要时修改小说文件，使用标准格式

## 配置文件

`config.json` 文件说明：

```json
{
  "chapters_per_day": 2,              // 每天发布几章
  "publish_times": ["08:00", "20:00"], // 发布时间
  "headless": false                    // 是否显示浏览器（建议 false）
}
```

## 注意事项

1. **首次必须登录** - 使用测试登录功能扫码一次
2. **选择正确书本** - 如果有多本书，仔细选择目标书本
3. **定时发布在平台设置** - 设置后番茄平台自动发布
4. **设置完成可关机** - 不需要保持电脑运行
5. **章节格式要正确** - 使用标准章节标题格式
6. **网络要稳定** - 设置定时发布时需要网络

## 常见问题

### Q: 定时发布需要电脑一直开机吗？

A: 不需要！定时发布设置在番茄平台服务器上，设置完成后可以关闭电脑。

### Q: 如何修改已设置的定时发布？

A: 需要在番茄小说平台的作家后台手动修改。程序暂不支持修改功能。

### Q: 一次可以设置多少章？

A: 理论上没有限制。您可以一次设置 100 章、200 章甚至更多。

### Q: 我有多本书，如何选择发布到哪一本？

A:
1. 先使用功能 4 查看书本列表
2. 记住要发布的书本编号
3. 发布时会显示书本列表，输入编号选择

### Q: 如果程序无法自动获取书本列表怎么办？

A:
- 程序会提示手动选择
- 浏览器会打开发布页面
- 您在页面上手动选择书本
- 选择完成后输入 'ok' 继续

### Q: 发布失败怎么办？

A: 检查：
- 是否选择了正确的书本
- 是否已登录番茄小说
- 网络连接是否正常
- 章节内容是否为空
- 浏览器页面是否有错误提示

## 菜单功能说明

```
==================================================
番茄小说自动发布系统
==================================================
1. 创建/重置配置文件    - 生成或重置配置文件
2. 测试小说解析         - 测试是否能正确识别章节
3. 测试登录            - 扫码登录番茄小说（首次必须）
4. 查看书本列表         - 查看您的所有书籍（新增）
5. 立即批量发布        - 立即发布多个章节
6. 批量定时发布        - 设置定时发布（推荐）
0. 退出
==================================================
```

## 快速命令

```bash
# 启动主程序
python main.py

# 测试小说解析
python parser.py

# 单独运行发布器
python scheduler.py
```

## 需要帮助？

详细文档请查看 `README.md`

祝您使用愉快！
