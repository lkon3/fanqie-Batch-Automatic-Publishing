# 番茄小说自动发布系统

自动识别小说章节，批量发布到番茄小说平台的工具。支持在番茄平台设置定时发布，一次性安排好所有章节的发布时间。支持多本书籍管理，可选择发布到指定书本。

## 功能特性

- ✓ 自动识别小说章节标题和正文
- ✓ 支持 .txt 格式小说导入
- ✓ 自动批量发布到番茄小说
- ✓ **在番茄平台设置定时发布**（一次性设置多章的发布时间）
- ✓ **书本选择功能**（支持多本书籍，可指定发布目标）
- ✓ **查看书本列表**（自动获取您的所有书籍）
- ✓ 立即批量发布功能
- ✓ 支持手动扫码登录，保持登录状态
- ✓ 自动生成发布时间表，按天自动分配章节

## 核心功能说明

### 1. 批量定时发布（推荐）

这是**核心功能**，可以在番茄小说平台的发布页面选择"定时发布"，一次性设置所有章节的发布时间。

**示例：**
- 假设您有 60 章要发布
- 设置每天发布 2 章（早上 8:00 和晚上 20:00 各一章）
- 程序会自动为每一章设置发布时间：
  - 第 1 章：明天 08:00
  - 第 2 章：明天 20:00
  - 第 3 章：后天 08:00
  - 第 4 章：后天 20:00
  - ...以此类推，直到 60 章全部设置完成

**优势：**
- 一次性完成所有设置，无需每天操作
- 番茄平台自动按时发布，稳定可靠
- 发布期间电脑无需保持开机

### 2. 立即批量发布

适合需要立即发布多个章节的场景。

## 安装步骤

### 1. 安装 Python

确保已安装 Python 3.8 或更高版本。

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 首次运行

```bash
python main.py
```

程序会自动创建配置文件 `config.json`。

## 使用说明

### 配置文件说明

编辑 `config.json` 文件：

```json
{
  "novel_id": "",                    // 你的小说ID（可选）
  "publish_url": "https://fanqienovel.com/page/WriteNovel",  // 发布页面URL
  "headless": false,                 // 是否无头模式（true=不显示浏览器）
  "chapters_per_day": 2,             // 每天发布章节数
  "publish_times": ["08:00", "20:00"],  // 发布时间
  "account": {
    "phone": "",                     // 手机号（可选）
    "auto_login": true               // 自动登录
  }
}
```

### 快速开始（6 步）

#### 步骤 1: 启动程序

```bash
python main.py
```

#### 步骤 2: 测试登录（首次必须）

选择 `3. 测试登录`，在浏览器中扫码登录番茄小说。

登录成功后，状态会保存，下次无需重新登录。

#### 步骤 3: 查看书本列表（可选）

选择 `4. 查看书本列表`，程序会自动获取您的所有书籍。

如果您有多本书，可以在这里查看列表。

#### 步骤 4: 测试小说解析

选择 `2. 测试小说解析`，输入小说文件路径，验证是否能正确识别章节。

#### 步骤 5: 批量定时发布（核心功能）

选择 `6. 批量定时发布`，按照提示：
1. 输入小说文件路径
2. **选择目标书本**（从列表中选择要发布的书本）
3. 确认或修改发布配置
4. 查看发布计划预览
5. 确认开始

程序会自动为每一章设置定时发布，番茄平台将按设置的时间自动发布。

#### 步骤 6: 完成

所有章节设置完成后，您可以关闭程序。番茄平台会自动按时发布所有章节。

## 功能详解

### 查看书本列表

**功能说明：**
自动获取您在番茄小说平台的所有书籍。

**使用方法：**
1. 运行 `python main.py`
2. 选择 `4. 查看书本列表`
3. 程序会显示您的所有书籍

**适用场景：**
- 查看自己有哪些书籍
- 确认书本名称后再发布

### 批量定时发布

**适用场景：**
- 有大量章节需要发布
- 希望按固定节奏持续更新（如每天 2 章）
- 不想每天手动操作

**操作流程：**

1. 运行 `python main.py`
2. 选择 `6. 批量定时发布`
3. 输入小说文件路径
4. **选择目标书本**（程序会显示您的书本列表，输入编号选择）
5. 确认或修改配置：
   - 每天发布章节数（如 2）
   - 发布时间（如 08:00, 20:00）
   - 开始日期（默认明天）
6. 查看发布计划预览
7. 确认开始

程序会自动：
- 打开浏览器，进入发布页面
- **选择指定的书本**
- 为每一章选择"定时发布"
- 设置对应的发布日期和时间
- 提交发布

**示例：**

假设您有 30 章，设置：
- 每天发布 2 章
- 发布时间：08:00, 20:00
- 开始日期：2024-01-15

发布计划：
```
第 1 章 → 2024-01-15 08:00
第 2 章 → 2024-01-15 20:00
第 3 章 → 2024-01-16 08:00
第 4 章 → 2024-01-16 20:00
...
第 29 章 → 2024-01-29 08:00
第 30 章 → 2024-01-29 20:00
```

全部设置完成后，番茄平台会自动按时发布，无需任何干预。

### 立即批量发布

**适用场景：**
- 需要立即发布多个章节
- 一次性发布已存稿

**操作流程：**

1. 运行 `python main.py`
2. 选择 `4. 立即批量发布`
3. 输入小说文件路径
4. 输入要发布的章节数（或输入 `all` 发布全部）
5. 确认开始

## 小说文件要求

### 格式要求

- **文件格式**：.txt 文本文件
- **文件编码**：UTF-8 或 GBK
- **章节标题**：需要使用可识别的格式

### 章节标题格式示例

程序会自动识别以下格式：

```
第一章 开始
第二章 内容
第3章 标题
Chapter 1
1. 章节标题
1、章节标题
【第一章 开始】
```

**推荐格式：**
```
第一章 开始

章节正文内容...

第二章 继续

更多正文内容...
```

## 常见问题

### 1. 定时发布是如何工作的？

答：程序会在番茄小说平台的发布页面点击"定时发布"选项，为每一章设置一个未来的发布时间。设置完成后，番茄平台会自动按时发布，无需程序持续运行。

### 2. 设置定时发布后，还需要保持电脑开机吗？

答：不需要！定时发布设置在番茄平台的服务器上，设置完成后可以关闭电脑和程序，番茄平台会自动按时发布。

### 3. 如何修改已设置的定时发布？

答：需要在番茄小说平台的作家后台手动修改。本程序暂不支持修改功能。

### 4. ChromeDriver 相关错误怎么办？

答：如果出现 `WinError 193` 或 `ChromeDriver not found` 等错误：

**快速解决方法：**

1. 运行测试脚本：
```bash
python test_browser.py
```

2. 如果测试失败，查看《ChromeDriver安装指南.md》

**手动安装 ChromeDriver：**

1. 查看 Chrome 版本：在 Chrome 地址栏输入 `chrome://version/`
2. 下载对应的 ChromeDriver：https://googlechromelabs.github.io/chrome-for-testing/
3. 将 `chromedriver.exe` 放到项目目录
4. 重新运行程序

**重新安装依赖：**
```bash
pip uninstall webdriver-manager -y
pip install webdriver-manager
```

### 5. 登录失败怎么办？

答：
- 删除 `chrome_profile` 目录，重新登录
- 检查网络连接
- 确认番茄小说网站可访问

### 6. 章节识别错误怎么办？

答：
- 确保章节标题格式正确
- 检查文件编码是否为 UTF-8 或 GBK
- 使用测试解析功能验证

### 7. 发布失败怎么办？

答：
- 检查网络连接
- 确认是否已登录番茄小说
- 检查章节内容是否为空
- 查看浏览器页面是否有错误提示

## 配置示例

### 每天发布 2 章（早晚各一次）

```json
{
  "chapters_per_day": 2,
  "publish_times": ["08:00", "20:00"]
}
```

### 每天发布 3 章

```json
{
  "chapters_per_day": 3,
  "publish_times": ["08:00", "14:00", "20:00"]
}
```

### 每天发布 1 章（晚上发布）

```json
{
  "chapters_per_day": 1,
  "publish_times": ["20:00"]
}
```

## 注意事项

1. **首次必须登录** - 使用测试登录功能扫码登录一次
2. **保持网络畅通** - 发布过程中需要连接番茄小说网站
3. **不要关闭浏览器** - 设置定时发布过程中不要关闭浏览器窗口
4. **章节格式** - 确保小说文件使用标准章节标题格式
5. **定时发布设置** - 设置后无法通过程序修改，需在番茄平台手动修改
6. **发布时间间隔** - 建议每章间隔至少 4 小时以上

## 文件说明

- `main.py` - 主程序（交互式菜单）
- `parser.py` - 小说章节解析器
- `publisher.py` - 番茄小说发布器（支持定时发布）
- `scheduler.py` - 批量定时发布调度器
- `requirements.txt` - 依赖包列表
- `config.json` - 配置文件（自动生成）
- `chrome_profile/` - Chrome浏览器配置目录（自动生成）

## 技术支持

如有问题或建议，请联系开发者。

## 许可证

本项目仅供学习和个人使用，请勿用于商业用途。使用本工具时请遵守番茄小说平台的相关规定。
